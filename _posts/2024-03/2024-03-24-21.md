---
title: 모던 리액트 Deep Dive 06장 - 리액트 개발 도구로 디버깅하기
categories: [React, Study]
tags: [react, monthlyCs, devtools]
comment: true
---

<br />

## 06장. 리액트 개발 도구로 디버깅하기

### 6.1 리액트 개발 도구란?

- react-dev-tools

  > - 리액트로 만들어진 다양한 애플리케이션을 디버깅하기 위해 만들어짐
  > - 리액트 웹뿐만 아니라 리액트 네이티브 등 다양한 플랫폼에서 사용 가능
  > - 브라우저 확장 프로그램을 사용하는 것이 가장 편리

<br />
<br />
<br />

### 6.2 리액트 개발 도구 설치

- react-dev-tools 설치
  > - 크롬, 파이어폭스, 엣지 브라우저 지원
  > - 브라우저 확장 도구 모음의 빨간색 리액트 로고는 리액트 개발 도구 (react-dev-tools) 가 **개발 모드**인 웹 어플리케이션에 접근할 수 있다는 의미
  > - **프로덕션에 배포**된 웹 어플리케이션에서는 원래 알고 있는 파란색 리액트 로고가 표시됨
  > - 리액트 개발도구가 정상적으로 접근할 수 없는 페이지이거나 리액트로 개발되지 않은 페이지에서는 회색 리액트 로고가 표시됨

<br />
<br />
<br />

### 6.3 리액트 개발 도구 활용하기

- 크롬 개발자 도구에 추가된 두 가지 메뉴 확인 (Components, Profiler)
  > - 컴포넌트: 정적인 현재 리액트 컴포넌트 트리의 내용을 디버깅하기 위한 도구
  > - 프로파일러: 리액트가 렌더링하는 과정에서 발생하는 상황을 확인하는 도구
  >   ![Desktop View](/assets/img/2024-03/2024-03-24-21-1.png){: width='972' height='589' }

<br />
<br />

##### 6.3.1 컴포넌트

- 컴포넌트 트리 구조, 컴포넌트명과 props, hooks 등 다양한 정보 확인 가능

<br />

- 컴포넌트 트리
  ![Desktop View](/assets/img/2024-03/2024-03-24-21-2.png){: width='972' height='589' }

  > - 왼쪽 영역은 리액트 페이지의 컴포넌트 트리
  > - 기명 함수로 선언되어 컴포넌트명을 알 수 있다면 해당 컴포넌트명을 표시
  > - 익명 함수로 선언된 컴포넌트는 Anonymous 로 표시
  > - 함수 선언식과 함수 표현식으로 생성된 컴포넌트는 모두 정상적으로 함수명이 표시됨
  > - 익명 함수를 default 로 export 한 경우 \_default 로 표시됨
  > - memo 를 사용해 익명 함수로 만든 컴포넌트를 감싼 경우 Anonymous 로 표시 (memo 라벨을 통해 memo 로 감싸진 컴포넌트임을 알 수 있음)
  > - 리액트 16.9 버전부터는 일부 컴포넌트가 Anonymous 대신 \_c3, \_c5 등으로 표시되어 어떤 컴포넌트인지 추정할 수 있는 힌트를 얻을 수 있음
  > - 기명 함수를 선언하는 것은 컴포넌트뿐만 아니라 디버깅하는 데 많은 도움이 됨
  > - 함수를 기명 함수로 바꾸기 어렵다면 함수에 displayName 속성을 추가 (고차 컴포넌트의 경우 일반적으로 고차 컴포넌트와 일반 컴포넌트의 조합으로 구성되므로 displayName 속성 활용)

  ```javascript
  const MemoizedComponent = memo(function () {
    return <>MemoizedComponent</>;
  });

  MemoizedComponent.displayName = '메모 컴포넌트';
  ```

<br />

- 컴포넌트명과 props

  > - 컴포넌트 트리에서 컴포넌트를 선택했을 때 해당 컴포넌트에 대한 자세한 정보를 보여주는 영역
  >   ![Desktop View](/assets/img/2024-03/2024-03-24-21-2.png){: width='972' height='589' }\
  > - 컴포넌트명은 SimpleLayout
  > - 빨간색 경고 이모티콘은 해당 애플리케이션이 strict mode 로 렌더링되지 않았다는 의미

<br />

- 컴포넌트 도구

  > - 눈 아이콘: 크롬 개발 도구의 Element 탭으로 이동, 해당 컴포넌트가 렌더링한 HTML 요소가 선택되는 것을 볼 수 있음
  > - 벌레 아이콘: console 탭에 해당 컴포넌트의 정보가 console.log 를 실행해 기록된 것을 확인할 수 있음 (해당 컴포넌트가 받은 props, 컴포넌트 내부에서 사용하는 hooks, 해당 컴포넌트의 HTML 요소인 nodes 가 기록)
  >   ![Desktop View](/assets/img/2024-03/2024-03-24-21-3.png){: width='972' height='589' }
  > - 소스코드 아이콘: 해당 컴포넌트의 소스코드 확인 가능, 좌측 하단의 {} 버튼 클릭하면 압축된 현재 자바스크립트 소스를 읽기 쉽게 볼 수 있음
  >   ![Desktop View](/assets/img/2024-03/2024-03-24-21-4.png){: width='972' height='589' }

<br />

- 컴포넌트 props

  > - 해당 컴포넌트가 받은 props 확인 가능
  > - props 정보 복사 가능 (클립보드로 복사, window.$r 에 저장)

<br />

- 컴포넌트 hooks

  > - 컴포넌트에서 사용 중인 hooks 확인 가능
  > - Hook 은 use 가 생략된 이름으로 나타남 (State, Reducer, Context, Memo, Callbak, Ref, id, LayoutEffect, Effect 이외 리액트에서 제공하는 hook 이 아니더라도 use 생략)
  > - Hook 에 기명 함수를 넘기면 해당 훅을 실행할 때 실행되는 함수의 이름을 확인할 수 있음

  ````javascript
  // before
  useEffect(() => {
    console.log('useEffect')
  })

  // after
  useEffect(function effectOnlyMount() {
    console.log('useEffect')
  })```
  ````

<br />

- 컴포넌트를 렌더링한 주체, rendered by
  > - rendered by 를 통해 해당 컴포넌트를 렌더링한 주체가 누구인지 확인할 수 있음
  > - 프로덕션 모드에서느 react-dom 의 버전만 확인할 수 있지만, 개발 모드에서는 해당 컴포넌트를 렌더링한 부모 컴포넌트까지 확인 가능

<br />
<br />

##### 6.3.2 프로파일러

- 리액트 애플리케이션이 렌더링되는 과정에서 어떤 컴포넌트가 렌더링됐는지, 렌더링이 몇 번 일어났으며 어떤 작업에서 오래 걸렸는지 가능

  > - 개발 모드에서 실행되는 리액트 애플리케이션에서 사용할 수 있음 (프로덕션 X)

<br />

- 유용한 설정

  > - General 탭 - Highlight updates when components render: 컴포넌트가 렌더링될 때마다 해당 컴포넌트에 하이라이트를 표시
  > - Debugging 탭 - Hide logs during second render in Strict Mode: 리액트 애플리케이션이 strict mode 에서 실행되는 경우, 디버깅을 위해 useEffect 등이 의도적으로 두 번씩 작동하는 것을 막고 싶다면 활성화
  > - Profiler 탭 - Record why each component rendered while profiling: 프로파일링 도중 무엇 때문에 컴포넌트가 렌더링됐는지 기록

<br />

- 프로파일링

  > ![Desktop View](/assets/img/2024-03/2024-03-24-21-5.png){: width='972' height='589' }
  >
  > - 왼쪽부터 첫 번째 버튼은 `Start Profiling` (프로파일링 시작) 버튼으로 프로파일링을 시작하고 중단할 수 있음
  > - 두 번째 `Reload and Start Profiling` (새로고침 후 프로파일링 시작) 버튼은 웹페이지를 새로고침하면서 동시에 프로파일링을 시작 (새로고침이 끝난다고 해서 프로파일링이 중단되지 않음)
  > - 세 번째`Stop Profiling` (프로파일링 종료) 버튼은 현재 프로파일링된 내용을 모두 삭제
  > - 네 번째, 다섯 번째 버튼은 각각 `Load Profile` (프로파일 불러오기), `Save Profile` (프로파일 저장하기) 버튼으로 프로파일링 결과를 저장하고 불러오는 버튼 (여기서 저장한 프로파일링 결과 (JSON 파일) 는 직접 열어서 확인하기는 복잡하므로 리액트 개발 도구에서 불러와서 확인)

<br />

- FlameGraph

  > ![Desktop View](/assets/img/2024-03/2024-03-24-21-6.png){: width='972' height='589' }
  >
  > - 트리 구조의 리액트 컴포넌트를 다른 형태로 확인할 수 있음
  > - 너비가 넓을수록 해당 컴포넌트를 렌더링하는 데 오래 걸렸다는 것을 의미 (순서)
  > - 렌더 커밋별로 어떤 작업이 일어났는지 나타냄
  > - 각 컴포넌트에 마우스 커서를 가져다 대면 렌더링이 일어난 컴포넌트의 렌더링 정보, 해당 컴포넌트가 렌더링된 이유, 전체 렌더링에서 소요된 시간을 확인할 수 있음
  > - 노란색에 가까울수록 렌더링이 오래 걸린 컴포넌트, 녹색에 가까울수록 빠르게 렌더링된 컴포넌트
  > - 회색은 렌더링되지 않음 컴포넌트
  > - 세로 막대 그래프 또는 세로 막대 그래프 오른쪽의 화살표를 클릭하면 각 렌더 커밋별로 리액트 트리에서 발생한 렌더링 정보 확인 가능 (렌더링 발생 횟수도 확인할 수 있음)
  > - ![Desktop View](/assets/img/2024-03/2024-03-24-21-7.png){: width='972' height='589' }

<br />

- Ranked

  > - 해당 커밋에서 렌더링하는 데 오랜 시간이 걸린 컴포넌트를 순서대로 나열한 그래프
  > - 렌더링이 발생한 컴포넌트에 대한 정보만 나타냄
  >   ![Desktop View](/assets/img/2024-03/2024-03-24-21-8.png){: width='972' height='589' }

<br />

- Timeline

  > - 리액트 18 이상의 환경에서 확인 가능
  > - 시간의 흐름에 따라 리액트가 작동하는 내용을 추적하는 데 유용
  > - 시간 단위로 프로파일링 기간 동안 무슨 일이 있었는지, 무엇이 어떤 시점에서 렌더링 됐는지 등을 자세히 확인할 수 있음
  >   ![Desktop View](/assets/img/2024-03/2024-03-24-21-9.png){: width='972' height='589' }

<br />

- 프로파일러로 렌더링 원인 파악에서 수정해 보기
  > - App 내부에 해당 input 과 관련된 state 가 있어서 input 에 입력되는 값이 바뀔 때마다 App 전체가 리렌더링되는 경우, input 을 별도의 컴포넌트로 분리
  > - state 변경을 최소 컴포넌트 단위로 분리함으로써 input 에 입력되는 값이 바뀌더라도 분리된 input 컴포넌트만 리렌더링되는 것을 확인할 수 있음

<br />
<br />
<br />

### 6.4 정리

- 컴포넌트 구조가 복잡해지기 전에! 틈틈이 컴포넌트 트리와 프로파일링을 실행해서 원하는 대로 렌더링되고 있는지, 메모이제이션을 활용한 최적화는 잘 되고 있는지 확인하기, 디버깅하기
